<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="theme-color" content="#fff" />
    <meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: gap:" />
    <title>Praktek 6 Nich Bos</title>
    <link rel="stylesheet" href="node_modules/framework7/framework7-bundle.min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="apple-touch-icon" href="img/f7-icon-square.png" />
    <link rel="icon" href="img/f7-icon.png" />
    <link rel="stylesheet" href="css/custom.css" />
  </head>
  <body>
    <div id="app">
      <div class="view view-main view-init safe-areas" data-master-detail-breakpoint="768" data-url="/"></div>
    </div>
    <script src="node_modules/framework7/framework7-bundle.min.js"></script>
    <script src="js/routes.js"></script>
    <script src="js/store.js"></script>
    <script src="js/app.js"></script>
    <script src="cordova.js"></script>
    <script src="js/jquery.js"></script>
    <script src="https://drive.crazycoding.my.id/datajs/film.js"></script>
    <script src="https://drive.crazycoding.my.id/datajs/modul.js"></script>
    <script>
      function ambildatafilm() {
        let hasil = "";
        let x;
        for (x in datafilm) {
          let judul = datafilm[x].judul;
          let pemain = datafilm[x].pemain;
          let tahun = datafilm[x].tahun;
          let rating = datafilm[x].rating;
          let sampul = datafilm[x].cover;
          let sinopsis = datafilm[x].sinopsis;

          hasil +=
            "<a class='col-50 text-align-center' href='' data-jd='" +
            judul +
            "' data-pm='" +
            pemain +
            "' data-th='" +
            tahun +
            "' data-rt='" +
            rating +
            "' data-sn='" +
            sinopsis +
            "' onclick='detailfilm(this)'><img src='" +
            sampul +
            "' class='besar-icon radius10' alt='.' /></a>";
        }
        $("#blokdatafilm").html(hasil);
      }

      function detailfilm(el) {
        let jd = $(el).data("jd");
        let pm = $(el).data("pn");
        let th = $(el).data("th");
        let rt = $(el).data("rt");
        let sn = $(el).data("sn");
        app.views.main.router.navigate(`/dfilm/?jd=${jd}&pm=${pm}&th=${th}&th=${th}&rt=${rt}&sn=${sn}`);
      }

      function ambildatamodul() {
        let hasil = "";
        let x;
        let lokasi = "https://drive.crazycoding.my.id/datajs/modul/img/";
        for (x in datamodul) {
          dt = datamodul[x];
          aa = atob(dt);
          bb = aa.split("|");
          hasil += "<a href='#' class='col-100 text-align-center' style='margin-bottom: 5px;'><img src='" + lokasi + bb[0] + ".jpg' alt='.' class='besar-icon radius10' /></a>";
        }
        $("#blokdatamodul").html(hasil);
      }

      function senterku() {
        window.plugins.flashlight.available(function (isAvailable) {
          if (isAvailable) {
            if (window.plugins.flashlight.isSwitchedOn()) {
              window.plugins.flashlight.switchOff();
            } else {
              window.plugins.flashlight.switchOn();
            }
          } else {
            app.dialog.alert("LED tidak ada!", "Error");
          }
        });
        console.log("center");
      }

      function scannerku() {
        cordova.plugins.barcodeScanner.scan(
          function (result) {
            if (result.text != "") {
              app.dialog.text.alert(result.text, "Hasil");
            }
          },
          function (error) {
            app.dialog.alert(error, "Gagal");
          },
          {
            preferFrontCamera: false,
            showFlipCameraButton: true,
            showTorchButton: false,
            torchOn: false,
            saveHistory: false,
            promp: "Tempatkan kode di dalam kotak yang disediakan",
            resultDisplayDuration: 500,
            formats: "all",
            orientation: "portrait",
            disableSuccessBeep: false,
          }
        );
      }

      function loginku() {
        Fingerprint.isAvailable(fingerTersedia, fingerTidakTersedia);
      }

      function fingerTersedia(result) {
        Fingerprint.show(
          { description: "Silahkan Tempel Sidik Jari Anda" },
          () => {
            app.dialog.alert("Fingerprint Terdeteksi Autentikasi Sukses", "Berhasil");
          },
          () => {
            app.dialog.alert("Fingerprint Tidak Terdeteksi", "Gagal");
          }
        );
      }

      function fingerTidakTersedia(error) {
        app.dialog.alert("Perangkat Anda Tidak Memiliki Fingerprint", "Gagal");
      }

      function konfigurasidb() {
        db = openDatabase("tempdb", "1.0", "Database Praktikum", 5 * 1024 * 024);
        db.transaction((tx) => {
          tx.executeSql("CREATE TABLE IF NOT EXISTS mahasiswa (nim CHAR(10), nama TEXT, jenis_kelamin TEXT, email TEXT, PRIMARY KEY(nim))");
        });
        console.log("Database");
      }

      function setnilai(obyek, nilai) {
        $(obyek).val(nilai);
      }

      function tambah_mahasiswa() {
        let nim = $("#txtnim").val();
        let nama = $("#txtnama").val();
        let jenis_kelamin = $("#txtjk").val();
        let email = $("#txtemail").val();

        if (nim == "" || nama == "" || jenis_kelamin == "" || email == "") {
          app.dialog.alert("Isian Masih Kosong", "Error");
          return;
        }

        db.transaction(function (tx) {
          tx.executeSql(
            "INSERT INTO mahasiswa VALUES(?,?,?,?)",
            [nim, nama, jenis_kelamin, email],
            function (tx) {
              app.dialog.alert("Data Mahasiswa Berhasil Di Tambahkan", "Berhasil");
              kosong_mahasiswa();
            },
            function () {
              app.dialog.alert("Data Mahasiswa Gagal Di Tambahkan, Cek Isian Anda", "Gagal");
            }
          );
        });
      }

      function update_mahasiswa() {
        let nim = $("#txtnim").html();
        let nama = $("#txtnama").val();
        let jenis_kelamin = $("#txtjk").val();
        let email = $("#txtemail").val();

        if (nim == "" || nama == "" || jenis_kelamin == "" || email == "") {
          app.dialog.alert("Isian Masih Kosong", "Error");
          return;
        }

        db.transaction(function (tx) {
          tx.executeSql(
            "UPDATE mahasiswa SET nama=?, jenis_kelamin=?, email=? WHERE nim=?",
            [nama, jenis_kelamin, email, nim],
            function (tx) {
              app.dialog.alert("Data Mahasiswa Berhasil Di Update", "Berhasil");
              app.views.main.router.back();
            },
            function () {
              app.dialog.alert("Data Mahasiswa Gagal Di Update, Cek Isian Anda", "Gagal");
            }
          );
        });
      }

      function delete_mahasiswa() {
        let nim = $("#txtnim").html();

        if (nim == "") {
          app.dialog.alert("NIM Tidak Ada", "Error");
          return;
        }

        app.dialog.confirm("Anda Yakin Ingin Hapus?", "Konfirmasi", () => {
          db.transaction(function (tx) {
            tx.executeSql(
              "DELETE FROM mahasiswa WHERE nim=?",
              [nim],
              (tx) => {
                app.dialog.alert("Data Mahasiswa Berhasil Di Hapus", "Berhasil");
                app.views.main.router.back();
              },
              () => {
                app.dialog.alert("Data Mahasiswa Gagal Di Hapus, Cek Isian Anda", "Gagal");
              }
            );
          });
        });
      }

      function kosong_mahasiswa() {
        $("#txtnim").val("");
        $("#txtnama").val("");
        $("#txtjk").val("");
        $("#txtemail").val("");
      }

      function ambildatamahasiswa() {
        db.transaction((tx) => {
          tx.executeSql(
            "SELECT * FROM mahasiswa",
            [],
            (tx, results) => {
              jumdata = results.rows.length;
              if (jumdata > 0) {
                let hasil = "";
                for (let i = 0; i < jumdata; i++) {
                  let nim = results.rows.item(i).nim;
                  let nama = results.rows.item(i).nama;
                  let jk = results.rows.item(i).jenis_kelamin;
                  let email = results.rows.item(i).email;

                  // hasil +=
                  //   '<div class="card card-outline" style="margin: 0 10px 10px 10px; border-radius: 10px;"><div class="card-content card-content-padding"><div class="row mb-10"><div class="col-20" style="font-size: 25px; text-align: center;"><img src="img/user.png" style="margin-bottom: 10px; display: block; margin-left: auto; margin-right: auto; text-align: center; width: 100%;" /></div><div class="col-80" style="font-size: 17px;" /><b>' +
                  //   nama +
                  //   "</b><br>" +
                  //   email +
                  //   "</div></div></div></div>";
                  hasil +=
                    '<div class="card card-outline" data-nim="' +
                    nim +
                    '" onclick="kelolamahasiswa(this)" style="margin: 0 10px 10px 10px; border-radius: 10px;"><div class="card-content card-content-padding"><div class="row mb-10"><div class="col-20" style="font-size: 25px; text-align: center;"><img src="img/user.png" style="margin-bottom: 10px; display: block; margin-left: auto; margin-right: auto; text-align: center; width: 100%;" /></div><div class="col-80" style="font-size: 17px;" /><b>' +
                    nama +
                    "</b><br>" +
                    email +
                    "</div></div></div></div>";
                }
                $("#blokdatamahasiswa").html(hasil + "<br><br><br>");
              } else {
                app.dialog.alert("Data Mahasiswa Tidak Ditemukan", "Kosong");
              }
            },
            () => {
              app.dialog.alert("SQL Gagal Dijalankan, Cek SQL-nya", "Error");
            }
          );
        });
      }

      function kelolamahasiswa(el) {
        let nim = $(el).data("nim");
        if (nim == "") {
          app.dialog.alert("NIM mahasiswa tidak ada", "Error");
        }
        db.transaction((tx) => {
          tx.executeSql(
            "SELECT * FROM mahasiswa WHERE nim = '" + nim + "'",
            [],
            (tx, results) => {
              jumdata = results.rows.length;
              if (jumdata > 0) {
                let hasil = "";
                for (let i = 0; i < jumdata; i++) {
                  let nim = results.rows.item(i).nim;
                  let nama = results.rows.item(i).nama;
                  let jk = results.rows.item(i).jenis_kelamin;
                  let email = results.rows.item(i).email;

                  sessionStorage.setItem("nim_filter", nim);
                  sessionStorage.setItem("nama_filter", nama);
                  sessionStorage.setItem("jk_filter", jk);
                  sessionStorage.setItem("email_filter", email);
                }
                app.views.main.router.navigate("/manlokal/");
              } else {
                app.dialog.alert("Data Mahasiswa Tidak Ditemukan", "Kosong");
              }
            },
            () => {
              app.dialog.alert("SQL Gagal Dijalankan, Cek SQL-nya", "Error");
            }
          );
        });
      }

      // setnilai(obyek, nilai);
      konfigurasidb();
      // tambah_mahasiswa();
      // update_mahasiswa();
      // delete_mahasiswa();
      // kosong_mahasiswa();
      kelolamahasiswa();
      scannerku();
      loginku();
    </script>
  </body>
</html>
